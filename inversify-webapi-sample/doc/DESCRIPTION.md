# 他人に「こんなものだよ」って説明する場合のためのテキスト

https://github.com/kazuhito-m/nodejs-express-typescript-webapp-sample

## 前提

最初に伝えて置きたいのは「自分の好み全開なので、あまり押す気はないし、採用されてもアレンジ要」ってこと。

- 「DDD をする（レイヤードな構造を持つ)のに邪魔しない形」を目指した
  - ある程度の自由度と「FW 側が足かせに成って自由度を阻害する」ができるだけないように
  - node.js&TypeScript で <https://github.com/system-sekkei/isolating-the-domain> の風にできないか？という模倣
- 完成した形は「できるだけ書かなくて良い」だが、仕組みの部分は「自分でわかるよう」に
  - ![構造のイメージ](structure-image.png)
  - ただ「組み合わせただけ」ではこうならない
    - 自分で「盛った」は勿論あり、それは「とあるコンテキストにまみれている」ので使うならアレンジ要るかも
- まだ未完成

## 内容

- ソースのウォークスルー
  - コントローラ
  - インフラ層
  - ドメイン(ロジック自体)
  - DI
- 機能面
  - 設定ファイル読み
    - コマンドラインと自動と
- 期せず(ねらったわけではないが)Java＆SpringBoot に構成が似る
- テスト用 DB の考慮
  - Docker
- DB マイグレーション
- Lint
  - このコードの形をつくるため、緩和しまくってる
  - テスト時に fix 走るように仕込んでる
- テスト(テスタビリティ)
  - 基本、DDD っぽくやってるなら「小クラス主義」「必要なものはコンストラクタで注入」「イミュータブル」なので、「単体テストの書きやすさ」は約束出来る
    - てか構造で守るので個々のクラスにはテスト要らんとも
  - テストスイートは `Jest` 使ってるのであんま心配してない
  - e2e は一応「テスト内で完結して」かける
    - `supertest` っていう「Express 専用の内部で起動して Inspect して死んでいく』ライブラリを使っている
  - コントローラに直接と e2e と両方書いてみた

## 課題

- e2e テスト時の「アプリ起動後、止める必要が在る』構造
  - Application クラスを元に「Express が勝手に始まる仕組み」を用意したが、DB 関係で「いつまでもお割らない」問題あり
    - その解決のため「かならずテスト終わりに呼ばなければならないメソッド」が出来た
  - Application クラス自体も煩雑で構造整理をしたい
- データベース込の「サービス or コントローラテスト」
  - テストベッドの「自前での動的な用意」と「トランザクションクリア」がほしい
  - CI なら「テスト時に Docker を立てとく」でできるけど
- 実用としての「耐えうるかどうか」
  - 一つ、実際に「機能作ってみて」からでないとわからない
- 統一的な「エラー処理ルール」
  - そのシステムにおいての「定型的な処理」が分かれば、毎回書いているところは仕組み化出来るかも
- ロギング
  - 上記と同じで「典型的な処理」がわかれば AOP 的に仕組み化できるかも
    - でも DI あるけど AOP のやり方わかってない
